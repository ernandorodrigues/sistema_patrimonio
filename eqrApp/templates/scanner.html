<!-- Div para exibir o seletor de câmeras -->
<div id="camera-selector" class="mt-2 mb-2 d-none">
    <select id="camera-select" class="form-select">
        <!-- Options will be dynamically added here -->
    </select>
</div>

<script>
    // Verifica se o dispositivo é um dispositivo móvel
    const isMobileDevice = () => {
        return /Mobi|Android/i.test(navigator.userAgent);
    };

    // Função para adicionar opções de câmera ao seletor de câmera
    const populateCameraOptions = (cameras) => {
        const cameraSelect = document.getElementById('camera-select');
        cameras.forEach((camera, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = camera.name;
            cameraSelect.appendChild(option);
        });
    };

    // Evento ao selecionar uma câmera no seletor
    document.getElementById('camera-select').addEventListener('change', function() {
        const selectedCameraIndex = parseInt(this.value);
        if (!isNaN(selectedCameraIndex)) {
            scanner.start(cameras[selectedCameraIndex]);
        }
    });

    // Função para mostrar o seletor de câmeras se for um dispositivo móvel
    const showCameraSelectorIfNeeded = () => {
        if (isMobileDevice()) {
            document.getElementById('camera-selector').classList.remove('d-none');
        }
    };

    $('#uni_modal').on('shown.bs.modal', function() {
        if ($('#scanner').length > 0) {
            scanner.stop();
            Instascan.Camera.getCameras().then(function(cameras) {
                if (cameras.length > 0) {
                    populateCameraOptions(cameras);
                    scanner.start(cameras[0]);
                    showCameraSelectorIfNeeded();
                } else {
                    console.error('No cameras found.');
                }
            }).catch(function(e) {
                console.error(e);
            });
        }
    });
</script>
