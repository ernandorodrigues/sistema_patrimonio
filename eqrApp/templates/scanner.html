{% load qr_code %}{% load static %}
<!-- <script src="{% static 'assets/default/js/jquery-3.6.0.min.js' %}"></script> -->
<script src="{% static 'assets/instascan.min.js' %}"></script>
<style>
    #uni_modal .modal-footer {
        display: none;
    }

    #uni_modal .modal-sub-footer {
        display: flex;
    }

    #scanner {
        width: 100%;
        height: 50vh;
        margin: 0px auto;
        position: relative;
        object-fit: cover;
        object-position: center center;
    }

    #scanner-focus {
        background: #00000085;
        -webkit-clip-path: polygon(0% 0%, 0% 100%, 25% 100%, 25% 25%, 75% 25%, 75% 75%, 25% 75%, 25% 100%, 100% 100%, 100% 0%);
        clip-path: polygon(0% 0%, 0% 100%, 25% 100%, 25% 25%, 75% 25%, 75% 75%, 25% 75%, 25% 100%, 100% 100%, 100% 0%);
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
    }
</style>
<div class="container-fluid">
    <div id="scanner-holder" class="position-relative">
        <video id="scanner"></video>
        <div id="scanner-focus" class="position-absolute"></div>
    </div>
</div>
<script>
    const videoElement = document.getElementById('scanner');
    let scanner = null;

    function startScanner() {
        Instascan.Camera.getCameras().then(function(cameras) {
            const frontCamera = cameras.find(camera => camera.name.includes('front'));
            if (frontCamera) {
                scanner = new Instascan.Scanner({ video: videoElement, mirror: false });
                scanner.addListener('scan', function(content) {
                    $('.modal').modal('hide');
                    start_loader();
                    setTimeout(() => {
                        uni_modal("View Employee Details", "{% url 'scanned-code' %}/" + content, 'modal-md');
                        scanner.stop();
                    }, 500);
                });
                scanner.start(frontCamera);
            } else {
                console.error('Front camera not found.');
            }
        }).catch(function(e) {
            console.error(e);
        });
    }

    startScanner();

    $('#uni_modal').on('hide.bs.modal', function() {
        if (scanner) {
            scanner.stop();
        }
    });

    function start_loader() {
        // Implementação para iniciar o loader (exemplo)
        $('#loader').show();
    }

    function uni_modal(title, url, size) {
        // Implementação para exibir o modal com o conteúdo do URL (exemplo)
        $.ajax({
            url: url,
            success: function (response) {
                $('#uni_modal .modal-title').text(title);
                $('#uni_modal .modal-dialog').attr('class', 'modal-dialog ' + size);
                $('#uni_modal .modal-content').html(response);
                $('#uni_modal').modal('show');
                stop_loader();
            }
        });
    }
</script>

<!-- Modal HTML -->
<div class="modal fade" id="uni_modal" tabindex="-1" aria-labelledby="uniModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uniModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Conteúdo carregado dinamicamente -->
            </div>
        </div>
    </div>
</div>

<!-- Loader HTML -->
<div id="loader" style="display:none;">Carregando...</div>
