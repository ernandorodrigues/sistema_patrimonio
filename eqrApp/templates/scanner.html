{% load qr_code %}{% load static %}
<script src="{% static 'assets/instascan.min.js' %}"></script>
<style>
    #uni_modal .modal-footer {
        display: none;
    }

    #uni_modal .modal-sub-footer {
        display: flex;
    }

    #scanner {
        width: 100%;
        height: 50vh;
        margin: 0 auto;
        position: relative;
        object-fit: cover;
        object-position: center center;
    }

    #scanner-focus {
        background: #00000085;
        -webkit-clip-path: polygon(0% 0%, 0% 100%, 25% 100%, 25% 25%, 75% 25%, 75% 75%, 25% 75%, 25% 100%, 100% 100%, 100% 0%);
        clip-path: polygon(0% 0%, 0% 100%, 25% 100%, 25% 25%, 75% 25%, 75% 75%, 25% 75%, 25% 100%, 100% 100%, 100% 0%);
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
    }
</style>
<div class="container-fluid">
    <div id="scanner-holder" class="position-relative">
        <video id="scanner"></video>
        <div id="scanner-focus" class="position-absolute"></div>
    </div>
</div>
<script>
    const videoElement = document.getElementById('scanner');
    const scanner = new Instascan.Scanner({ video: videoElement, mirror: false });

    // Função para verificar se uma câmera é traseira
    function isBackCamera(camera) {
        return camera.name.toLowerCase().includes('back');
    }

    // Inicialização do scanner Instascan
    Instascan.Camera.getCameras().then(function(cameras) {
        console.log('All cameras:', cameras);
        // Filtrar apenas as câmeras traseiras
        const backCameras = cameras.filter(isBackCamera);
        console.log('Back cameras:', backCameras);

        if (backCameras.length > 0) {
            // Selecionar a primeira câmera traseira disponível
            const selectedCamera = backCameras[0];
            console.log('Selected camera:', selectedCamera);
            scanner.start(selectedCamera);
        } else {
            console.error('No back cameras found.');
        }
    }).catch(function(error) {
        console.error('Error getting cameras:', error);
    });

    // Evento para parar o scanner ao fechar o modal
    $('#uni_modal').on('hide.bs.modal', function() {
        scanner.stop();
    });
</script>
